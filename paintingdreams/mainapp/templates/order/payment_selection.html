{% extends "mainapp_base.html" %}

{% block content %}
<h1>Order summary / payment</h1>
<p>Order number: {{ order.unique_id }}</p>
<div class="panel panel-default">
  <div class="panel-body">
    <table class="table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Item total</th>
        </tr>
      </thead>
      <tbody>
    {% for item in order.orderline_set.all %}
        <tr>
            <td>{{ item.quantity}} x {{ item.title }}</td>
            <td>&pound;{{ item.line_price }}</td>
        </tr>
    {% endfor %}
      </tbody>
    </table>
    <p>Sub total: &pound;{{ order.sub_total_price }}</p>
    <p>Postage: &pound;{{ order.postage_price }}</p>
    <p>Total: &pound;{{ order.total_price }}</p>
  </div>
</div>
<div class="panel panel-default order-addresses">
  <div class="panel-body">
    <p>{{ order.customer_name }}</p>
    <p>{{ order.customer_email }}</p>
    <h4>Billing address</h4>
    <p>{{ order.billing_address.address1 }}</p>
    <p>{{ order.billing_address.address2 }}</p>
    <p>{{ order.billing_address.address3 }}</p>
    <p>{{ order.billing_address.address4 }}</p>
    <p>{{ order.billing_address.city }}</p>
    <p>{{ order.billing_address.state }}</p>
    <p>{{ order.billing_address.post_code }}</p>
    <p>{{ order.billing_address.country.name }}</p>
    <h4>Delivery address</h4>
    {% if order.shipping_address %}
    <p>{{ order.shipping_name }}</p>
    <p>{{ order.shipping_address.address1 }}</p>
    <p>{{ order.shipping_address.address2 }}</p>
    <p>{{ order.shipping_address.address3 }}</p>
    <p>{{ order.shipping_address.address4 }}</p>
    <p>{{ order.shipping_address.city }}</p>
    <p>{{ order.shipping_address.state }}</p>
    <p>{{ order.shipping_address.post_code }}</p>
    <p>{{ order.shipping_address.country.name }}</p>
    {% else %}
    <p>{{ order.customer_name }}</p>
    <p>{{ order.billing_address.address1 }}</p>
    <p>{{ order.billing_address.address2 }}</p>
    <p>{{ order.billing_address.address3 }}</p>
    <p>{{ order.billing_address.address4 }}</p>
    <p>{{ order.billing_address.city }}</p>
    <p>{{ order.billing_address.state }}</p>
    <p>{{ order.billing_address.post_code }}</p>
    <p>{{ order.billing_address.country.name }}</p>
    {% endif %}
    <p><a href="/order-start" class="btn btn-default" role="button">Change these details</a></p>
  </div>
</div>
<div>
{% if transaction %}
  <a name="payment"></a>
  <h2>Make payment</h2>
  <div class="panel panel-default" id="selected-payment">
    <div class="panel-body">
      <p>Your selected payment method is: <span class="text-warning larger-text"><strong>
        {% if transaction.payment_processor == 'paypal' %}PayPal{% endif %}
        {% if transaction.payment_processor == 'cardsave' %}Cardsave Gateway from Worldpay{% endif %}
      </strong></span></p>
      <form method="POST" action="/order-payment#payment">
        {% csrf_token %}
        <input type="hidden" name="cancel-current-trans" value="true" />
        <button type="submit" class="btn btn-default btn-sm">Change payment method</button>
      </form>
      <p><span class="text-danger"><strong>Only change payment method if you haven't already submitted payment</strong></span></p>
    </div>
  </div>
  {{ transaction.form|safe }}
{% else %}
  <h2>Choose payment method</h2>
  <form method="POST" id="payment-selection" action="/order-payment#payment">
    {% csrf_token %}
    <div class="radio">
      <label>
        <input type="radio" name="payment_processor" value="paypal"><span class="paypal-button">PayPal</span>
      </label>
    </div>
    <div class="radio">
      <label>
        <input type="radio" name="payment_processor" value="cardsave"><span class="cardsave-button">Cardsave</span>
      </label>
    </div>
    <button type="submit" class="btn btn-primary">Continue</button>
  </form>
{% endif %}
</div>
{% endblock %}
